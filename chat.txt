import pandas as pd

def save_misclassifications(input_file='evaluation_results.xlsx', output_file='misclassifications.xlsx'):
    # 读取包含评测结果的 Excel 文件
    df = pd.read_excel(input_file)

    # 初始化一个字典，用于存储每个模型的错误分类
    misclassifications = {}

    # 遍历每个模型的预测列，识别错误分类
    model_columns = ['minicheck_pred', 'hhem_pred', 'factual_consistency_pred']
    for model_col in model_columns:
        # 过滤出错误分类样本
        misclassified_df = df[df['label'] != df[model_col]].copy()
        
        # 添加该模型的错误分类到字典中
        misclassifications[model_col] = misclassified_df[['Context', 'Answer', 'label', model_col]]

    # 将每个模型的错误分类结果保存到一个新的 Excel 文件的不同 sheet 中
    with pd.ExcelWriter(output_file) as writer:
        for model_col, misclassified_df in misclassifications.items():
            sheet_name = model_col + '_misclassified'
            misclassified_df.to_excel(writer, sheet_name=sheet_name, index=False)
    
    print(f"Misclassifications saved to {output_file}")

# 使用该函数
save_misclassifications()
