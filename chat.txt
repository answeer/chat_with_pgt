import json
import os
import uuid
from datetime import datetime

import requests
from django.conf import settings
from django.http import HttpResponse
from django.urls import resolve
from django.utils.deprecation import MiddlewareMixin
from rest_framework.exceptions import PermissionDenied


class ImageSynthHeaderAuthMiddleware(MiddlewareMixin):

    def process_request(self, request):
        if (str(request.path_info) == "/api/v1/heartbeat"):
            return None
        auth_token = request.headers.get('authorization', None) or request.headers.get('Authorization', None)

        if auth_token and auth_token==settings.AUTH_TOKEN:
            return None
        else:
            return HttpResponse('Please provide a Authorization in header with Token', status=401)
