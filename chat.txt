import matplotlib.pyplot as plt
from sklearn.metrics import roc_curve, auc

class EvalDataset:
    # ... (之前的代码不变)

    def plot_results(self, results, save_path='model_inference_plot.png'):
        # 设置绘图
        plt.figure(figsize=(10, 8))

        # 绘制每个模型的 ROC 曲线
        for model_nm, (_, _, predictions) in results.items():
            # 获取对应模型的真实标签和预测分数
            true_labels = [1 if label == 1 else 0 for label in predictions]  # 将标签转换为0和1
            pred_scores = [pred if pred is not None else 0 for pred in predictions]  # 确保无效预测分数为0

            # 计算 ROC 曲线和 AUC
            fpr, tpr, _ = roc_curve(true_labels, pred_scores)
            roc_auc = auc(fpr, tpr)

            # 绘制 ROC 曲线
            plt.plot(fpr, tpr, label=f'{model_nm} (AUC = {roc_auc:.2f})')

        # 绘制随机猜测的参考线
        plt.plot([0, 1], [0, 1], 'k--', label='Random (AUC = 0.5)')

        # 图形参数设置
        plt.xlabel('False Positive Rate')
        plt.ylabel('True Positive Rate')
        plt.title('ROC AUC Curve for Models')
        plt.legend(loc="lower right")

        # 保存并显示图像
        plt.savefig(save_path)
        plt.show()
        print(f"ROC AUC plot saved to {save_path}")

# 其他代码保持不变
