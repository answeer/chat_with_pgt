# app.py

from flask import Flask, request, jsonify
from paddleocr import PaddleOCR
import io
from PIL import Image

app = Flask(__name__)

# 初始化PaddleOCR模型
ocr = PaddleOCR(use_angle_cls=True, lang='ch')  # 这里设置中文OCR，如果是英文，使用lang='en'

@app.route('/ocr', methods=['POST'])
def ocr_api():
    if 'image' not in request.files:
        return jsonify({'error': 'No image file provided'}), 400

    image_file = request.files['image']
    try:
        # 使用PIL打开图片
        image = Image.open(image_file.stream)

        # OCR识别
        result = ocr.ocr(image, cls=True)

        # 提取识别结果
        ocr_result = []
        for line in result[0]:
            ocr_result.append({'text': line[1][0], 'confidence': line[1][1]})

        return jsonify({'result': ocr_result})

    except Exception as e:
        return jsonify({'error': str(e)}), 500

if __name__ == '__main__':
    app.run(debug=True)



# test_ocr_api.py

import requests

# 设置请求的API URL
url = "http://127.0.0.1:5000/ocr"

# 读取图像文件
image_path = 'test_image.jpg'  # 修改为你测试的图片路径
files = {'image': open(image_path, 'rb')}

# 发送POST请求
response = requests.post(url, files=files)

# 打印API响应
if response.status_code == 200:
    print("OCR识别结果:", response.json())
else:
    print("错误:", response.text)
