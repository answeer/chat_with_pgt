# Transform coordinates
matched_rows = df[df['name'].str.contains(file_name, case=False)]
bounding_boxes = []
updated_rows = []

for _, row in matched_rows.iterrows():
    box = (row['x_min'], row['y_min'], row['x_max'], row['y_max'])
    transformed_box = transform_coordinates([box], matrix)[0]

    bounding_boxes.append(transformed_box)

    updated_rows.append({
        'name': row['name'],
        'x_min': transformed_box[0],
        'y_min': transformed_box[1],
        'x_max': transformed_box[2],
        'y_max': transformed_box[3]
    })

# Draw bounding boxes on the aligned image
image_with_boxes = draw_bounding_boxes(aligned, bounding_boxes)
boxes_path = os.path.join(output_dir, f"boxes_{idx + 1}.png")
cv2.imwrite(boxes_path, image_with_boxes)
