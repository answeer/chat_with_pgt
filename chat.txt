from llm_sanitation.scanners.scanner_base import Scanner
import re
from llm_sanitation.logging.logging_setup import LogUtil, LogType, LogLevel

class RemoveEmojis(Scanner):

    def __init__(self, **kwargs):
        sanitize = kwargs["sanitize"]
        super().__init__("remove_emojies", 0.5,sanitize=sanitize)

    def predict(self, data):
        sanitized_data = data
        score = 0
        try:
            emoji_pattern = re.compile("["
            u"\U0001F600-\U0001F64F"  # emoticons
            u"\U0001F300-\U0001F5FF"  # symbols & pictographs
            u"\U0001F680-\U0001F6FF"  # transport & map symbols
            u"\U0001F1E0-\U0001F1FF"  # flags (iOS)
                            "]+", flags=re.UNICODE)
            sanitized_data = emoji_pattern.sub(r'', data)
            score = 1
        except Exception as e:
            LogUtil.log(LogType.ERROR, LogLevel.ERROR, e)

        return score, sanitized_data

    def format_response(self):
        self.response["score"] = self.pred[0]
        self.response['sanitized_data'] = self.pred[1]
